{% extends "base.html" %}
{% block title %}Transfert d'Employ√© | HexaQu√©bec{% endblock %}

{% block content %}
<style>
/* ===== BACKGROUND ===== */


/* ===== CARD ===== */
.transfer-card {
  max-width: 650px;
  margin: auto;
  background: linear-gradient(145deg, #ffffff, #f0f6ff);
  border-radius: 24px;
  padding: 2.8rem;
  box-shadow: 0 25px 60px rgba(0, 0, 0, 0.12);
  animation: slideFade 0.8s ease;
  position: relative;
  overflow: hidden;
}

/* Bande d√©corative */
.transfer-card::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  height: 6px;
  width: 100%;
  background: linear-gradient(135deg, #007bff, #6610f2);
}

/* Animation */
@keyframes slideFade {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ===== TITRE ===== */
.transfer-card h3 {
  font-weight: 800;
  color: #b02a37;
  text-align: center;
  margin-bottom: 2rem;
  letter-spacing: 0.6px;
}

/* ===== LABELS ===== */
.form-label {
  font-weight: 600;
  color: #374151;
  margin-bottom: 0.3rem;
}

/* ===== INPUTS ===== */
.form-control {
  border-radius: 14px;
  padding: 0.65rem 0.9rem;
  border: 1px solid #e5e7eb;
  transition: all 0.25s ease;
}

.form-control:focus {
  border-color: #dc3545;
  box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.2);
}

/* ===== TEXTAREA ===== */
textarea.form-control {
  resize: none;
}

/* ===== BUTTON ===== */
.btn-transfer {
  background: linear-gradient(135deg, #0d6efd,  #0d6efd);
  color: #fff;
  border: none;
  border-radius: 16px;
  font-weight: 700;
  padding: 0.7rem;
  letter-spacing: 0.4px;
  box-shadow: 0 10px 25px rgba(220, 53, 69, 0.35);
  transition: all 0.3s ease;
}

.btn-transfer:hover {
  transform: translateY(-2px);
  box-shadow: 0 15px 35px rgba(220, 53, 69, 0.45);
}

/* ===== ALERTS ===== */
.alert {
  border-radius: 14px;
  font-weight: 500;
  animation: slideFade 0.5s ease;
}

/* ===== ICON INPUT ===== */
.input-group-text {
  background: #fff;
  border-radius: 14px 0 0 14px;
  border: 1px solid #e5e7eb;
}

/* ===========================
   üì± FIX MOBILE ‚Äì TRANSFER CARD
   =========================== */
@media (max-width: 768px) {

  .transfer-card {
    max-width: 75%;          /* prend toute la largeur */
    margin: 0.8rem auto;      /* respire sans d√©border */
    padding: 1.4rem;          /* r√©duit le padding */
    border-radius: 18px;      /* plus fin sur mobile */
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
  }

  .transfer-card h3 {
    font-size: 1.1rem;        /* titre plus compact */
    margin-bottom: 1.2rem;
  }

  .form-control {
    font-size: 0.95rem;
    padding: 0.55rem 0.75rem;
  }

  .btn-transfer {
    padding: 0.65rem;
    font-size: 0.95rem;
    border-radius: 14px;
  }
}

.btn-outline-secondary {
  border-radius: 16px;
  font-weight: 600;
}

</style>

<div class="transfer-bg">
  <div class="transfer-card">

    <h3>
      <i class="bi bi-arrow-left-right me-2"></i>
      Transfert d‚ÄôEmploy√©
    </h3>

    <!-- Messages -->
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
          <i class="bi bi-info-circle-fill me-1"></i>
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <form method="POST" autocomplete="off">
      {% csrf_token %}

      <div class="row g-3">

        <div class="col-md-6">
          <label class="form-label">Nom de l‚Äôemploy√©</label>
          <input type="text" name="nom_employe" class="form-control" placeholder="Nom" required>
        </div>

        <div class="col-md-6">
          <label class="form-label">Pr√©nom de l‚Äôemploy√©</label>
          <input type="text" name="prenom_employe" class="form-control" placeholder="Prenom" required>
        </div>

<div class="col-md-6">
  <label class="form-label">Date de naissance</label>
  <input
    type="date"
    name="date_naissance"
    class="form-control"
    min="1900-01-01"
    max="{{ today|date:'Y-m-d' }}"
    required
    oninput="forceYearLimit(this)"
  >
</div>







    <!-- Statut -->
    <div class="col-md-6">
      <label class="form-label">Statut de l‚Äôemploy√©</label>
      <select name="statut_canadien" class="form-control" id="statutCanadien" required>
        <option value="">-- S√©lectionner --</option>
        <option value="canadien" {% if employeur.statut_canadien == 'canadien' %}selected{% endif %}>Canadien / R√©sident permanent</option>
        <option value="etranger" {% if employeur.statut_canadien == 'etranger' %}selected{% endif %}>Autre nationalit√©</option>
      </select>
    </div>

    <!-- NAS -->
    <div class="col-md-6 {% if employeur.statut_canadien != 'etranger' %}d-none{% endif %}" id="nasField">
      <label class="form-label">Num√©ro d‚Äôassurance sociale (NAS)</label>
      <input type="password" name="nas" id="nasInput" class="form-control"
             value="{{ employeur.nas }}" placeholder="123 456 789">
      <small class="text-muted">üîí Donn√©e prot√©g√©e ‚Äì conforme √† la Loi 25</small>
    </div>

   



        <div class="col-md-6">
          <label class="form-label">Poste occup√©</label>
          <input type="text" name="poste" class="form-control" placeholder="Technicien RH" required>
        </div>

<div class="col-md-6">
  <label class="form-label">Type d‚Äôop√©ration</label>
  <select name="type_operation"
          class="form-control"
          id="typeOperation"
          required>
    <option value="">-- S√©lectionner --</option>
    <option value="transfert">Transfert</option>
    <option value="embauche">Embauche</option>
  </select>
</div>


<div class="col-md-6 d-none" id="numeroEmployeField">
  <label class="form-label">Num√©ro employ√©</label>
  <input type="text"
         name="numero_employe"
         id="numeroEmployeInput"
         class="form-control"
         placeholder="Num√©ro employ√©">
</div>





        <div class="col-md-12">
          <label class="form-label">Nouvel employeur</label>
          <input type="text" name="nouvelle_entreprise" class="form-control" placeholder="TechnoSoud Inc." required>
        </div>

        <div class="col-md-12">
          <label class="form-label">Date du transfert</label>
          <input type="date" name="date_transfert" class="form-control" required>
        </div>

        <div class="col-md-12">
          <label class="form-label">Message (facultatif)</label>
          <textarea name="message" rows="4" class="form-control" placeholder="Raison ou d√©tails du transfert..."></textarea>
        </div>
        <!-- Boutons action -->
<div class="d-flex justify-content-between gap-2 mt-4">
  <a href="{% url 'profil_employeur' %}" class="btn btn-outline-secondary w-100">
    <i class="bi bi-arrow-left-circle me-1"></i>
    Retour au profil
  </a>

  <button type="submit" formmethod="post" class="btn btn-transfer w-100">
    <i class="bi bi-send-fill me-1"></i>
    Envoyer le Transfert
  </button>
</div>


      </div>

    </form>

  </div>
</div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const statut = document.getElementById("statutCanadien");
  const nasField = document.getElementById("nasField");
  const nasInput = document.getElementById("nasInput");

  statut.addEventListener("change", () => {
    if (statut.value === "etranger") {
      nasField.classList.remove("d-none");
      nasInput.required = true;
    } else {
      nasField.classList.add("d-none");
      nasInput.required = false;
      nasInput.value = "";
    }
  });

const typeOperation = document.getElementById("typeOperation");
const numeroField = document.getElementById("numeroEmployeField");
const numeroInput = document.getElementById("numeroEmployeInput");

typeOperation.addEventListener("change", () => {
  if (typeOperation.value === "transfert") {
    numeroField.classList.remove("d-none");
    numeroInput.required = true;
    numeroInput.value = "";      // champ vide
    numeroInput.focus();
  } else {
    numeroField.classList.add("d-none");
    numeroInput.required = false;
    numeroInput.value = "Embauche";
  }
});


function forceYearLimit(input) {
  if (!input.value) return;

  // Autorise uniquement YYYY-MM-DD
  let match = input.value.match(/^(\d{0,4})(?:-(\d{0,2}))?(?:-(\d{0,2}))?$/);
  if (!match) {
    input.value = "";
    return;
  }

  let year = match[1];
  let month = match[2] || "";
  let day = match[3] || "";

  // üî¥ Coupe l'ann√©e √† 4 chiffres MAX
  if (year.length > 5) {
    year = year.slice(0, 4);
  }

  input.value = year +
    (month ? "-" + month : "") +
    (day ? "-" + day : "");
}
</script>


{% endblock %}
